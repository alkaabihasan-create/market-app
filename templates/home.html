<script>
    const searchInput = document.getElementById('searchInput');
    const itemGrid = document.getElementById('itemGrid');
    const noResults = document.getElementById('noResults');

    // This function handles the fetching and rendering
    async function fetchItems(query) {
        try {
            // If query is empty, this URL becomes /api/search?q= (which now returns ALL items)
            const response = await fetch(`/api/search?q=${query}`);
            const items = await response.json();

            // Clear current grid
            itemGrid.innerHTML = '';

            if (items.length === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
                
                // Rebuild the items
                items.forEach(item => {
                    const card = `
                    <a href="/item/${item.id}" class="box" style="margin: 0; padding: 0; overflow: hidden; text-align: left; display: block; transition: transform 0.2s;">
                        <div style="height: 250px; background: #eee; position: relative;">
                            <img src="${item.image}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div style="padding: 20px;">
                            <h3 style="margin: 0 0 5px 0; font-size: 17px; color: var(--text-main);">${item.name}</h3>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-color); margin-top: 10px;">
                                AED ${item.price}
                            </div>
                        </div>
                    </a>
                    `;
                    itemGrid.innerHTML += card;
                });
            }
        } catch (error) {
            console.error("Search failed:", error);
        }
    }

    // Listen for typing
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        // Calls the function (whether query is empty or not)
        fetchItems(query);
    });
</script>